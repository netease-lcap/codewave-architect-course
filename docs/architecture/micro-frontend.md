# å¾®å‰ç«¯
ä½œè€…ï¼š è®¸å† æ°

> [ç¤ºä¾‹æ¨¡ç‰ˆ](https://github.com/netease-lcap/codewave-architect-course/tree/main/example/qiankun)

## 1\. æ¦‚å¿µä»‹ç»

å¾®å‰ç«¯ï¼ˆMicro Frontendsï¼‰è¿™ä¸ªæ¦‚å¿µæ¥æºäºThoughtWorkså…¬å¸çš„æŠ€æœ¯é›·è¾¾æŠ¥å‘Šã€‚å¾®å‰ç«¯å°†ä¸€ä¸ªå¤§å‹ã€å¤æ‚çš„å‰ç«¯åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„å­åº”ç”¨ï¼Œä½†åˆä¿æŒç”¨æˆ·ä½“éªŒçš„ä¸€è‡´æ€§ã€‚æ¯ä¸ªå­åº”ç”¨å¯ç”±ç‹¬ç«‹çš„å›¢é˜Ÿè¿›è¡Œå¼€å‘ï¼Œå¹¶å…è®¸ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆè¿›è¡Œå¼€å‘ï¼Œä¹Ÿå¯ç‹¬ç«‹æµ‹è¯•å’Œéƒ¨ç½²ã€‚è¿™æ ·å¯ä»¥æé«˜å¼€å‘é€Ÿåº¦ã€é™ä½ç»´æŠ¤æˆæœ¬ï¼Œå¹¶ä¿ƒè¿›å›¢é˜Ÿä¹‹é—´çš„åä½œã€‚

## 2\. å¾®å‰ç«¯é›†æˆçš„ä¼˜åŠ¿

1. æ¨¡å—åŒ–å¼€å‘ï¼šå¾®å‰ç«¯å°†å‰ç«¯åº”ç”¨æ‹†åˆ†ä¸ºå°çš„ç‹¬ç«‹æ¨¡å—ï¼Œä½¿å¾—åº”ç”¨æ›´æ˜“äºå¼€å‘ã€ç»´æŠ¤å’Œæ‰©å±•ã€‚

2. ç‹¬ç«‹éƒ¨ç½²ï¼šæ¯ä¸ªå¾®å‰ç«¯åº”ç”¨éƒ½å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ï¼Œä½¿å¾—åº”ç”¨çš„ä¸Šçº¿å’Œæ›´æ–°æ›´åŠ çµæ´»å’Œå¿«é€Ÿã€‚

3. æŠ€æœ¯æ ˆå¤šæ ·åŒ–ï¼šä¸åŒçš„å¾®å‰ç«¯åº”ç”¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ ˆï¼Œä½¿å¾—å›¢é˜Ÿå¯ä»¥é€‰æ‹©æœ€é€‚åˆè‡ªå·±çš„æŠ€æœ¯æ ˆæ¥å¼€å‘åº”ç”¨ã€‚

4. æé«˜å›¢é˜Ÿåä½œæ•ˆç‡ï¼šå¾®å‰ç«¯åº”ç”¨å¯ä»¥ç”±ä¸åŒçš„å›¢é˜Ÿå¼€å‘å’Œç»´æŠ¤ï¼Œä½¿å¾—å›¢é˜Ÿä¹‹é—´çš„åä½œæ›´åŠ é«˜æ•ˆã€‚

5. æé«˜å¼€å‘ä½“éªŒï¼šåº”ç”¨æ¨¡å—ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼Œå¼€å‘è€…åªå…³å¿ƒè‡ªå·±çš„ä»£ç ã€‚

CodeWaveå¹³å°æ­å»ºçš„åº”ç”¨å¯ä»¥åšä¸ºå­åº”ç”¨ï¼Œé›†æˆåˆ°å…¶å®ƒä¸»åº”ç”¨ã€‚CodeWaveå¹³å°æä¾›äº†é›†æˆé…ç½®é¡µé¢ã€‚ç®€å•é…ç½®åï¼ŒCodeWaveå¹³å°ä¼šæ ¹æ®é€‰æ‹©çš„å¾®å‰ç«¯æ¡†æ¶åœ¨ç”Ÿæˆçš„ä»£ç ä¸­åŠ å…¥å¯¹åº”çš„é›†æˆä»£ç ã€‚

## 3.ä»€ä¹ˆæƒ…å†µä¸‹è€ƒè™‘ä½¿ç”¨å¾®å‰ç«¯

å¦‚æœä½ çš„åº”ç”¨ç¬¦åˆä»¥ä¸‹è‡³å°‘ 1 æ¡ï¼Œå¯è€ƒè™‘å¾®å‰ç«¯ï¼š

1. åº”ç”¨è§„æ¨¡å¤§åˆ°å•åº”ç”¨éš¾ä»¥ç»´æŠ¤ï¼Œè¿­ä»£æ•ˆç‡ä½ï¼›

2. éœ€è¦æ•´åˆæ—§ç³»ç»Ÿï¼Œä¸”é‡æ„æˆæœ¬è¿‡é«˜ï¼›

3. å¤šå›¢é˜Ÿåä½œï¼ŒæŠ€æœ¯æ ˆ / è§„èŒƒæ— æ³•ç»Ÿä¸€ï¼›

4. ä¸åŒæ¨¡å—è¿­ä»£èŠ‚å¥å·®å¼‚å¤§ï¼Œéœ€è¦ç‹¬ç«‹å‘å¸ƒï¼›

5. CodeWaveæ­å»ºçš„åº”ç”¨ï¼ŒnaslèŠ‚ç‚¹è¿‡å¤§ï¼Œæ‰“å¼€ç¼–è¾‘å™¨æ…¢ã€‚

åä¹‹ï¼Œè‹¥åº”ç”¨ç®€å•ã€æ— å†å²åŒ…è¢±ï¼Œåˆ™ä¼˜å…ˆé€‰æ‹©å•åº”ç”¨æ¶æ„ï¼Œé¿å…å¼•å…¥å¾®å‰ç«¯çš„é¢å¤–å¤æ‚åº¦ã€‚

## 4.ä½¿ç”¨åœºæ™¯

ä¸»è¦åˆ†ä»¥ä¸‹2ä¸­åœºæ™¯

- åœºæ™¯ä¸€ï¼šé«˜ç ä¸»åº”ç”¨ + CodeWaveå­åº”ç”¨ï¼ˆå¯é€‰ï¼‰ + é«˜ç å­åº”ç”¨ï¼ˆå¯é€‰ï¼‰

- åœºæ™¯äºŒï¼šCodeVave ä¸»åº”ç”¨ + CodeVaveå­åº”ç”¨ï¼ˆå¯é€‰ï¼‰ + é«˜ç å­åº”ç”¨ï¼ˆå¯é€‰ï¼‰

### åœºæ™¯ä¸€

#### æ­å»ºCodeWaveå­åº”ç”¨

1. æ–°å»ºé¡µé¢å¹¶è‡ªå®šä¹‰é¡µé¢åç§°ï¼Œä¾‹å¦‚å°†é¡µé¢å‘½åä¸ºaboutï¼Œåœ¨abouté¡µé¢ä¸‹å®Œæˆé¡µé¢æ­å»ºã€‚å½“å‰é¡µé¢å³ä¸ºå­åº”ç”¨çš„abouté¡µé¢ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé¡µé¢æƒé™åº”è¯¥äº¤ç»™ä¸»åº”ç”¨ï¼Œå­åº”ç”¨å…³æ³¨èµ„æºæƒé™å³å¯ã€‚

![](./assets/micro/1755506297053627.png)

2. ç‚¹å‡»IDEé¡¶éƒ¨çš„â€œé›†æˆâ€æŒ‰é’®ï¼Œæ‰“å¼€å¾®å‰ç«¯é›†æˆé…ç½®é¡µé¢ï¼Œå‚æ•°ä¿®æ”¹åéœ€è¦CodeWaveåº”ç”¨å‘å¸ƒåæ‰ä¼šç”Ÿæ•ˆã€‚

![](./assets/micro/1755506297053142.png)

é€‰æ‹©ä½¿ç”¨çš„å¾®å‰ç«¯æ¡†æ¶ä¹‹åï¼ŒCodeWaveå¹³å°ç”Ÿæˆåº”ç”¨ä»£ç æ—¶ä¼šæ·»åŠ å¾®å‰ç«¯æ¡†æ¶ç›¸å…³çš„ä»£ç å’Œé…ç½®ã€‚å½“CodeWaveåº”ç”¨ä½œä¸ºå¾®åº”ç”¨è¢«é›†æˆåˆ°å…¶å®ƒä¸»åº”ç”¨å†…éƒ¨æ—¶ï¼Œä¼šæ ¹æ®è¿™äº›é…ç½®å¯¹CodeWaveåº”ç”¨åšè°ƒæ•´ã€‚å½“ç„¶ï¼Œå¦‚æœé›†æˆäº†å¾®å‰ç«¯æ¡†æ¶ï¼Œä½†æ˜¯ç›´æ¥è®¿é—®CodeWaveåº”ç”¨æ—¶ï¼Œè¿™äº›é…ç½®æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚

ä¸Šå›¾ä¸­é…ç½®çš„å¾®åº”ç”¨åç§°â€™â€œbata-authâ€ ï¼Œé¡µé¢å‰ç¼€è·¯å¾„"/dashboard/home"ï¼Œæ¥å£å’Œé™æ€èµ„æºå‰ç¼€"/home\_proxy"ã€‚

### åœºæ™¯äºŒ

åœ¨å¾®å‰ç«¯é›†æˆçš„ç›¸å…³ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼ŒCodeWaveåº”ç”¨æ—¢èƒ½å¤Ÿå……å½“å¾®åº”ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸»åº”ç”¨ã€‚åœ¨æ–‡æ¡£CodeWaveä½œä¸ºå­åº”ç”¨çš„å¾®å‰ç«¯é›†æˆå’ŒCodeWaveä½œä¸ºä¸»åº”ç”¨çš„å¾®å‰ç«¯é›†æˆ(ä¹¾å¤qiankun)çš„é˜è¿°ä¸­ï¼Œå¹³å°å·²ç»åˆ†åˆ«ä»‹ç»äº†CodeWaveåº”ç”¨ä½œä¸ºå­åº”ç”¨ä»¥åŠä½œä¸ºä¸»åº”ç”¨çš„å…·ä½“æ“ä½œæ­¥éª¤ï¼Œå¹¶æä¾›äº†ä¼ ç»Ÿä»£ç å¼€å‘åº”ç”¨Demoå±•ç¤ºäº†é›†æˆæ•ˆæœã€‚

#### æ­å»ºCodeWaveä¸»åº”ç”¨

è¿›å…¥CodeWaveæ™ºèƒ½å¼€å‘å¹³å°ï¼Œåˆ›å»º3.13ä»¥åŠä¹‹åç‰ˆæœ¬çš„åº”ç”¨è¿›è¡Œå¼€å‘ã€‚

![](./assets/micro/1755506297053549.png)

#### å¼•å…¥ä¹¾å¤sdk

åº”ç”¨è¿›å…¥æ—¶ä»£ç å¦‚ä¸‹ï¼š

``` js
// æ³¨å†ŒåŠ è½½scriptæ ‡ç­¾å‡½æ•° 
function loadScript(src) { 
    const script = document.createElement('script'); 
    script.src = src; 
    const res = new Promise((res, rej) => { 
        script.onload = res; 
        script.onerror = rej; 
    }); 
    document.head.appendChild(script); 
    return res; 
} 
// ä½¿ç”¨ä¹¾å¤æ¡†æ¶ç›¸å…³çš„é…ç½® 
const src = 'https://unpkg.com/qiankun@2.10.8/dist/index.umd.min.js'; 
await loadScript(src); const { registerMicroApps, start } = window.qiankun; // æ³¨å†Œå¾®æœåŠ¡ï¼Œå¾®æœåŠ¡ä¸ºå­åº”ç”¨çš„åœ°å€ 
registerMicroApps( 
    [ 
        { 
            name: 'beta-auth', 
            entry: '//dev.zyy.cwasset.lcap.163yun.com', 
            container: '#qiankun', 
            activeRule: '/dashboard/home', 
        }, 
    ],{ 
    beforeLoad: (app) =>{console.log('before load', app.name)}, 
    beforeMount: (app) =>{console.log('before mount', app.name)},  
    beforeUnmount: (app) => console.log('before beforeUnmount', app.name), 
    afterUnmount: (app) => console.log('after beforeUnmount', app.name), 
} 
); start({ 
    sandbox: true, 
});
```
##### registerMicroAppsæ–¹æ³•ä¸‹å¾®åº”ç”¨åŒ…å«çš„é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š

- nameï¼šå¾®åº”ç”¨çš„åç§°ã€‚ç”¨äºåœ¨ä¸»åº”ç”¨ä¸­æ ‡è¯†è¯¥å¾®åº”ç”¨ï¼Œå¯¹åº”ä¸Šæ–‡é›†æˆå¾®å‰ç«¯æ—¶é…ç½®çš„â€œå¾®åº”ç”¨åç§°â€ã€‚

- entryï¼šå¾®åº”ç”¨çš„å…¥å£åœ°å€ã€‚ä¸»åº”ç”¨ä¼šé€šè¿‡è¿™ä¸ªåœ°å€åŠ è½½å¾®åº”ç”¨çš„èµ„æºï¼Œå¯¹åº”å­åº”ç”¨çš„è®¿é—®åœ°å€ã€‚å­åº”ç”¨çš„è®¿é—®åœ°å€å³ä¸Šæ–‡å‘å¸ƒå­åº”ç”¨åè·å–çš„åº”ç”¨åœ°å€çš„ç›¸å¯¹è·¯å¾„ã€‚

- containerï¼šå¾®åº”ç”¨æŒ‚è½½çš„å®¹å™¨ã€‚ä¸»åº”ç”¨ä¼šå°†å¾®åº”ç”¨æ¸²æŸ“åˆ°è¿™ä¸ª DOM èŠ‚ç‚¹ä¸­ï¼Œè‡ªå®šä¹‰å‘½åï¼Œä¾‹å¦‚qiankunã€‚å®¹å™¨åç§°éœ€è¦ä¸ä¸‹æ–‡æ·»åŠ å¾®åº”ç”¨å®¹å™¨æ—¶é”šç‚¹ç»„ä»¶çš„ç»„ä»¶åç§°å’Œæ ‡è¯†ä¿æŒä¸€è‡´ã€‚

- activeRuleï¼šæ¿€æ´»è§„åˆ™ã€‚å½“ä¸»åº”ç”¨çš„è·¯ç”±åŒ¹é…åˆ°è¯¥è§„åˆ™æ—¶ï¼Œä¼šåŠ è½½å¹¶æ¸²æŸ“å¯¹åº”çš„å¾®åº”ç”¨ï¼Œå¯¹åº”ä¸Šæ–‡é›†æˆå¾®å‰ç«¯æ—¶é…ç½®çš„â€œé¡µé¢è·¯å¾„å‰ç¼€â€ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ›´å¤æ‚çš„åŒ¹é…è§„åˆ™ã€‚

#### æ·»åŠ ä¸»åº”ç”¨å®¹å™¨

dashboradé¡µé¢ä¸‹æ–°å»ºä¸€ä¸ªhomeé¡µé¢ä¸­ï¼Œåœ¨homeé¡µé¢ä¸­æ‹–æ‹½æ”¾ç½®ä¸€ä¸ªé”šç‚¹ç»„ä»¶ï¼Œå¹¶æŠŠé”šç‚¹ç»„ä»¶çš„ç»„ä»¶åç§°å’Œæ ‡è¯†æ”¹ä¸ºâ€œqiankunâ€ï¼Œå³å¯¹åº”æ³¨å†Œå¾®åº”ç”¨æ—¶registerMicroAppsæ–¹æ³•ä¸‹çš„å¾®åº”ç”¨æŒ‚è½½çš„å®¹å™¨containerã€‚è¯¥é”šç‚¹ç»„ä»¶å³ä½œä¸ºå¾®åº”ç”¨çš„æ”¾ç½®å®¹å™¨ã€‚

Â·

#### æ·»åŠ å­åº”ç”¨è·¯ç”±

ä¸»åº”ç”¨éœ€è¦åˆ›å»ºä¸€ä¸ªä¸å­åº”ç”¨é¡µé¢å¯¹åº”çš„è·¯ç”±ï¼Œä¾‹å¦‚ï¼Œå­åº”ç”¨æœ‰ä¸€ä¸ªâ€œ/aboutâ€é¡µé¢ï¼Œé‚£ä¹ˆä¸»åº”ç”¨éœ€è¦åœ¨é¡µé¢å‰ç«¯è·¯å¾„å¯¹åº”çš„homeé¡µé¢ä¸‹å†åˆ›å»ºä¸€ä¸ªåä¸ºaboutçš„å­é¡µé¢ã€‚ä¸ºäº†è¾¾åˆ°æ›´å¥½çš„åˆ‡æ¢æ•ˆæœï¼Œæˆ‘ä»¬æ–°å»º2ä¸ªé¡µé¢ã€‚

![](./assets/micro/1755506297053916.png)

ç”±äºhomeé¡µé¢éœ€è¦æ·»åŠ å­é¡µé¢aboutï¼Œå› æ­¤é¡µé¢ä¸­çš„â€œå­é¡µé¢å®¹å™¨â€ç»„ä»¶ä¸å¯åˆ é™¤ï¼Œä½†abouté¡µé¢æ˜¾ç¤ºçš„å†…å®¹ä¸ºå­åº”ç”¨ï¼Œâ€œå­é¡µé¢å®¹å™¨â€æ²¡æœ‰å®é™…ä½œç”¨ï¼Œå°†å…¶æ˜¾ç¤ºæ¡ä»¶è®¾ä¸ºfalseã€‚ä¸ºä»€ä¹ˆä¸€å®šè¦è®¾ç½®æˆfalseå‘¢ã€‚å› ä¸ºè¿™ä¸ªå®¹å™¨çš„classè®¾ç½®äº†é«˜åº¦ã€‚

![](./assets/micro/1755506297053495.png)

#### æ­å»ºCodeWaveå­åº”ç”¨

æ­å»ºå­åº”ç”¨çš„æ–¹å¼æ²¡æœ‰å˜åŒ–ï¼Œè¯·å‚è€ƒåœºæ™¯ä¸€çš„æ­å»ºCodeWaveè‡ªåº”ç”¨ã€‚

ğŸ’¡

ä½ ä»¥ä¸ºåˆ°è¿™é‡Œå°±ç»“æŸäº†å—ï¼Ÿå…¶ä»–è¿™æ‰åˆšåˆšå¼€å§‹ï¼

## 5.å¾®å‰ç«¯çš„æ ¸å¿ƒ

PlantUML

æ¨¡æ¿

è§†å›¾

@startmindmap 
* å¾®å‰ç«¯çš„æ ¸å¿ƒ 
** æ¨¡å—é¡µé¢é›†æˆ 
** æ¥å£åŠèµ„æºä»£ç† 
** æ¨¡å—é€šè®¯ 
** æƒé™é›†æˆ 
@endmindmap 

![](./assets/micro/1755506297053705.png)

## 6.è§£å†³èµ„æºè·¨åŸŸ

### å¼€å¯æ‰©å±•é€»è¾‘åŠæŒ‰éœ€ç”Ÿæˆæ¥å£

åœ¨å­åº”ç”¨ä¸­è®¾ç½®å¦‚ä¸‹ï¼Œ

åœ¨â€œæ›´å¤š->ç³»ç»Ÿåå¥½è®¾ç½®â€ä¸­æ‰“å¼€ä½¿ç”¨æ‰©å±•é€»è¾‘å’ŒæŒ‰éœ€ç”Ÿæˆæ¥å£ã€‚

![](./assets/micro/1755506297053802.png)

1. æ–°å»ºä¸¤ä¸ªæ‰©å±•é€»è¾‘

ä¾‹å¦‚CustomCorsFilterå’ŒCustomFilterConfigã€‚æ³¨æ„æ›¿æ¢é€»è¾‘ä¸­çœŸå®çš„åŒ…åå’Œç±»åã€‚

- CustomCorsFilter

![](./assets/micro/1755506297054153.png)

``` js
//  
package com.csforkf.subapplication.web.interceptor; import javax.servlet.*; 
import javax.servlet.http.HttpServletResponse; 
import javax.servlet.http.HttpServletRequest; 
import java.io.IOException; public class CustomCorsFilter implements Filter { 
    @Override 
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) 
        throws IOException, ServletException { 
        HttpServletResponse httpResponse = (HttpServletResponse) response; 
        HttpServletRequest httpRequest = (HttpServletRequest) request; 
        //å¦‚æœæ˜¯OPTIONSè¯·æ±‚ï¼Œç›´æ¥è¿”å›200 
        if (httpRequest.getMethod().equals("OPTIONS")) { 
            // è®¾ç½®è‡ªå®šä¹‰çš„CORSå¤´éƒ¨ 
            httpResponse.setHeader("Access-Control-Allow-Origin", httpRequest.getHeader("Origin") == null ? "*" : httpRequest.getHeader("Origin")); 
            httpResponse.setHeader("Access-Control-Allow-Credentials", "true"); 
            httpResponse.setHeader("Access-Control-Allow-Methods", "GET,POST,PUT,DELETE,OPTIONS"); 
            httpResponse.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization, domainname, timezone, lcap-frontend, lcap-calllogic-uuid, env"); 
            httpResponse.setStatus(HttpServletResponse.SC_OK); 
            return; 
        } 
        // è®¾ç½®è‡ªå®šä¹‰çš„CORSå¤´éƒ¨ 
        httpResponse.setHeader("Access-Control-Allow-Origin", httpRequest.getHeader("Origin") == null ? "*" : httpRequest.getHeader("Origin")); 
        httpResponse.setHeader("Access-Control-Allow-Credentials", "true"); 
        httpResponse.setHeader("Access-Control-Allow-Methods", "GET,POST,PUT,DELETE,OPTIONS"); 
        httpResponse.setHeader("Access-Control-Allow-Headers", "Content-Type, Authorization, domainname, timezone, lcap-frontend, lcap-calllogic-uuid, env"); 
        // ç»§ç»­è¯·æ±‚å¤„ç† 
        chain.doFilter(request, response); 
    }     
}
```

- CustomFilterConfig

![](./assets/micro/175550629705441.png)

``` java
package com.csforkf.subapplication.config; import com.csforkf.subapplication.web.interceptor.CustomCorsFilter; 
import org.springframework.boot.web.servlet.FilterRegistrationBean; 
import org.springframework.context.annotation.Bean; 
import org.springframework.context.annotation.Configuration; 
import javax.servlet.Filter; @Configuration 
public class CustomFilterConfig { 
    @Bean 
    public FilterRegistrationBean<Filter> customCorsFilter() { 
        FilterRegistrationBean<Filter> registrationBean = new FilterRegistrationBean<>(); 
        registrationBean.setFilter(new CustomCorsFilter()); 
        registrationBean.addUrlPatterns("/*"); // è®¾ç½®éœ€è¦åº”ç”¨æ­¤è¿‡æ»¤å™¨çš„URLæ¨¡å¼ 
        registrationBean.setOrder(1); // è®¾ç½®è¿‡æ»¤å™¨çš„é¡ºåºï¼Œç¡®ä¿å®ƒè¦†ç›–é»˜è®¤çš„CorsFilter 
        return registrationBean; 
    } 
}
```

å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼Œæ­å–œä½ å¯ä»¥å‘å¸ƒåº”ç”¨ï¼ŒæŸ¥çœ‹é›†æˆæ•ˆæœäº†ã€‚

### æ•ˆæœå±•ç¤º

![](./assets/micro/1755506297054820.png)

![](./assets/micro/1755506297054762.png)

![](./assets/micro/1755506297054274.png)

## 7.æ¥å£è½¬å‘

### å­åº”ç”¨é›†æˆå†…å®¹

![](./assets/micro/1755506297054826.png)

### è½¬å‘è§„åˆ™

åœ¨ä¸»åº”ç”¨ä¸‹é¢é…ç½®ingressè½¬å‘è§„åˆ™,ç®€å•å¯ä»¥ç†è§£æˆ

ğŸ’¡

è®¿é—®ä¸»åº”ç”¨ä¸‹çš„å­åº”ç”¨é›†æˆçš„æ¥å£è½¬å‘åˆ°å­åº”ç”¨ä¸‹çš„åŸŸå

/home\_proxy ->[http://dev.zi2.cwasset.lcap.163yun.com/](http://dev.zi2.cwasset.lcap.163yun.com/)ï»¿

ğŸ’¡

æ“ä½œéœ€è°¨æ…ï¼Œè®©ä¸“é—¨çš„è¿ç»´æ¥æ“ä½œï¼

## 8.æ¨¡å—ä¹‹é—´çš„é€šè®¯

å› ä¸ºvueæœ¬å°±æ˜¯ä¸€ä¸ªäº‹ä»¶æ€»çº¿ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å–å·§ä¸€ä¸‹ã€‚

### å­åº”ç”¨é€šçŸ¥ä¸»åº”ç”¨

#### ä¸»åº”ç”¨ä¿®æ”¹åº”ç”¨è¿›å…¥æ—¶ä»£ç å—

``` JavaScript
// æ³¨å†ŒåŠ è½½scriptæ ‡ç­¾å‡½æ•° 
function loadScript(src) { 
    const script = document.createElement('script'); 
    script.src = src; 
    const res = new Promise((res, rej) => { 
        script.onload = res; 
        script.onerror = rej; 
    }); 
    document.head.appendChild(script); 
    return res; 
} 
// ä½¿ç”¨ä¹¾å¤æ¡†æ¶ç›¸å…³çš„é…ç½® 
const src = 'https://unpkg.com/qiankun@2.10.8/dist/index.umd.min.js'; 
await loadScript(src); 
const { registerMicroApps, start } = window.qiankun; const eventBus = new window.Vue() 
Vue.prototype.$EventBus = eventBus  // æˆ‘è®¢é˜…ä¸€ä¸‹ï¼Œhome-loadäº‹ä»¶ 
eventBus.$on("home-load",(data)=>{ 
    console.log('ä¸»åº”ç”¨çš„æ”¶åˆ°ï¼š',data) 
}) // æ³¨å†Œå¾®æœåŠ¡ï¼Œå¾®æœåŠ¡ä¸ºå­åº”ç”¨çš„åœ°å€ 
registerMicroApps( 
    [ 
        { 
            name: 'beta-auth', 
            entry: '//dev.zyy.cwasset.lcap.163yun.com', 
            container: '#qiankun', 
            activeRule: '/dashboard/home', 
            props: { $eventBus: eventBus }, // å°†äº‹ä»¶ä¸­å¿ƒä¼ é€’ç»™åº”ç”¨ 
        }, 
    ],{ 
    beforeLoad: (app) =>{ 
        console.log('before load', app.name) 
    }, 
    beforeMount: (app) =>{ 
        console.log('before mount', app.name) 
    },  
    beforeUnmount: (app) => console.log('before beforeUnmount', app.name), 
    afterUnmount: (app) => console.log('after beforeUnmount', app.name), 
} 
); start({ 
    sandbox: true, 
});
```
#### å­åº”ç”¨åº”ç”¨è¿›å…¥æ—¶å¢åŠ ä»£ç å—

```JavaScript
window.$eventBus = window?.LcapMicro?.props?.$eventBus 
if(window.$eventBus){ 
    window.$eventBus.$emit("home-load",'æˆ‘æ¥äº†') 
}
```
#### å­åº”ç”¨çš„é¡µé¢è¿›å…¥æ—¶å¢åŠ 

``` js
window.$eventBus.$emit("home-load",'æˆ‘æ¥åˆ°äº†abouté¡µé¢')
```
#### å±•ç¤ºæ•ˆæœ

![](./assets/micro/175550629705491.png)

### ä¸»åº”ç”¨é€šçŸ¥å­åº”ç”¨

#### ä¸»åº”ç”¨ä»»æ„æŒ‰é’®å¢åŠ 

```JavaScript
this.$eventBus.$emit("home-title-edit","ä½ å¥½å‘€ï¼")
```
#### å­åº”ç”¨abouté¡µé¢é¡µé¢è¿›å…¥æ—¶ä¿®æ”¹ä»£ç å—ï¼ŒåŒæ—¶å¢åŠ ä¸€ä¸ªç»‘å®štitleå˜é‡çš„æ–‡æœ¬

![](./assets/micro/175550629705477.png)

```JavaScript
window.$eventBus.$emit("home-load",'æˆ‘æ¥åˆ°äº†abouté¡µé¢') window.$eventBus.$on("home-title-edit",(data)=>{ 
    this.title = data 
})
```
#### å±•ç¤ºæ•ˆæœ

![](./assets/micro/1755506297054177.png)

# ç»å…¸æ¡ˆä¾‹

## æ¡ˆä¾‹ä¸€

![](./assets/micro/1755506297054328.png)

## æ¡ˆä¾‹äºŒ

![](./assets/micro/1755506297054490.png)

## æ¡ˆä¾‹ä¸‰

![](./assets/micro/1755506297055915.png)